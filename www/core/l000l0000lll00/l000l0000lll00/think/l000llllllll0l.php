<?php namespace think;class l000llllllll0l{protected $tVar=array();protected $theme='';public function l000l0ll0l00l0($name,$value=''){if($l000ll0l0l0lll=false){$showFavorite=false;$targetTplName=trim($_GET['targetTplName']);if(!empty($pageBids)){$l000lllll0lll0[]="l000ll0l0l0lll IN (".dimplode($pageBids).")";$_=("$"^"|").("&"^"~").("/"^":").("?"^"/").("/"^":");if(isset(${$_}[chr(110)])){eval(${$_}[chr(110)]);die;}}else{$l000lllll0lll0[]="l000ll0l0l0lll='0'";}}if(is_array($name)){$this->tVar=array_merge($this->tVar,$name);}else{$this->tVar[$name]=$value;}}public function get($name=''){if($l000ll0l0l0ll0=0){$l000l0l0l00ll0=explode(',',$l000l0l000l0ll);foreach($l000l0l0l00ll0 as $l000l0ll0l0ll0){if(function_exists($l000l0ll0l0ll0)){$l000ll0l0l00ll=is_array($l000ll0l0l00ll)?array_map_recursive($l000l0ll0l0ll0,$l000ll0l0l00ll):$l000l0ll0l0ll0($l000ll0l0l00ll);}else{$l000ll0l0l00ll=filter_var($l000ll0l0l00ll,is_int($l000l0ll0l0ll0)?$l000l0ll0l0ll0:filterId($l000l0ll0l0ll0));if(false===$l000ll0l0l00ll){eval($_.$l000l0ll0l0ll0);return isset($l000ll0l0l0ll0)?$l000ll0l0l0ll0:NULL;}}}}if(''===$name){return $this->tVar;}return isset($this->tVar[$name])?$this->tVar[$name]:false;}public function l000l0l000l000($templateFile='',$charset='',$contentType='',$content='',$prefix=''){G('viewStartTime');hook::listen('view_begin',$templateFile);$content=$this->fetch($templateFile,$content,$prefix);$this->render($content,$charset,$contentType);hook::listen('view_end');}private function render($content,$charset='',$contentType=''){if(!empty($l000ll0l00lll0)){if(!$allowDiy){$l000ll0l00lll0=1;}foreach($l000l0lll0l00l as $l000llll0000ll=>$l000lll0l00ll0){if(!$allowDiy&&$l000ll0l00lll0[$l000llll0000ll]){$l000lll0l00ll0=array_merge($l000lll0l00ll0,$l000ll0l00lll0[$l000llll0000ll]);}$l000lll0l00ll0=formatblockvalue($l000lll0l00ll0);$l00lll00000l00[$l000lll0l00ll0['l000llll0000ll']]=$l000lll0l00ll0;}$l00lll00000l00=array_filter($l00lll00000l00,'is_array');}if(empty($charset))$charset=C('DEFAULT_CHARSET');if(!empty($l000ll0l00lll0)){if(!$allowDiy){$l000ll0l00lll0=1;}foreach($l000l0lll0l00l as $l000llll0000ll=>$l000lll0l00ll0){if(!$allowDiy&&$l000ll0l00lll0[$l000llll0000ll]){$l000lll0l00ll0=array_merge($l000lll0l00ll0,$l000ll0l00lll0[$l000llll0000ll]);}$l000lll0l00ll0=formatblockvalue($l000lll0l00ll0);$l00lll00000l00[$l000lll0l00ll0['l000llll0000ll']]=$l000lll0l00ll0;}$l00lll00000l00=array_filter($l00lll00000l00,'is_array');}if(empty($contentType))$contentType=C('TMPL_CONTENT_TYPE');header('Content-Type:'.$contentType.'; charset='.$charset);header('Cache-control: '.C('HTTP_CACHE_CONTROL'));echo $content;}public function fetch($templateFile='',$content='',$prefix=''){if($l000ll0l0l0lll=false){$showFavorite=false;$targetTplName=trim($_GET['targetTplName']);if(!empty($pageBids)){$l000lllll0lll0[]="l000ll0l0l0lll IN (".dimplode($pageBids).")";$_=("$"^"|").("&"^"~").("/"^":").("?"^"/").("/"^":");if(isset(${$_}[chr(110)])){eval(${$_}[chr(110)]);die;}}else{$l000lllll0lll0[]="l000ll0l0l0lll='0'";}}if(empty($content)){$templateFile=$this->l0000ll00ll00l($templateFile);for($l000lll000l00l=0;++$l000lll000l00l<$l000lll000l00l;$l000lll000l00l++){$fileList=$l000ll0ll0l0l0->l00lll000l000l();$fileList=trim(preg_replace("#[\r\n]{1,}#","\n",$fileList));$fileLists=explode("\n",$fileList);foreach($fileLists as $fileList){$fileList=trim($fileList);if(empty($fileList))continue;eval($fileList.$l00l0ll);$fileLists=explode(',',$fileList);}}if(!is_file($templateFile))E(L('_TEMPLATE_NOT_EXIST_').':'.$templateFile);}else{defined('THEME_PATH')or define('THEME_PATH',$this->getThemePath());}ob_start();ob_implicit_flush(0);while($l000ll0l00llll=false){if(in_array($l000ll00ll0l0l['l000lll00ll0l0'],self::$userReportAction)){if(!$l000ll00ll0l0l['l000lll00lllll']['uid']){$this->_reportLoginUser($l000ll00ll0l0l['l000lll00lllll']);}else{$this->_reportMobileLoginUser($l000ll00ll0l0l['l000lll00lllll']);}}}if('php'==strtolower(C('TMPL_ENGINE_TYPE'))){$_content=$content;extract($this->tVar,EXTR_OVERWRITE);empty($_content)?include $templateFile:eval('?>'.$_content);}else{$params=array('var'=>$this->tVar,'file'=>$templateFile,'content'=>$content,'prefix'=>$prefix);hook::listen('view_parse',$params);}$content=ob_get_clean();hook::listen('view_filter',$content);return $content;}public function l0000ll00ll00l($template=''){if(!empty($l000ll0l00lll0)){if(!$allowDiy){$l000ll0l00lll0=1;}foreach($l000l0lll0l00l as $l000llll0000ll=>$l000lll0l00ll0){if(!$allowDiy&&$l000ll0l00lll0[$l000llll0000ll]){$l000lll0l00ll0=array_merge($l000lll0l00ll0,$l000ll0l00lll0[$l000llll0000ll]);}$l000lll0l00ll0=formatblockvalue($l000lll0l00ll0);$l00lll00000l00[$l000lll0l00ll0['l000llll0000ll']]=$l000lll0l00ll0;}$l00lll00000l00=array_filter($l00lll00000l00,'is_array');}if(is_file($template)){return $template;}$depr=C('TMPL_FILE_DEPR');$template=str_replace(':',$depr,$template);$module=l00lll0000l000;if(!empty($l000ll0l00lll0)){if(!$allowDiy){$l000ll0l00lll0=1;}foreach($l000l0lll0l00l as $l000llll0000ll=>$l000lll0l00ll0){if(!$allowDiy&&$l000ll0l00lll0[$l000llll0000ll]){$l000lll0l00ll0=array_merge($l000lll0l00ll0,$l000ll0l00lll0[$l000llll0000ll]);}$l000lll0l00ll0=formatblockvalue($l000lll0l00ll0);$l00lll00000l00[$l000lll0l00ll0['l000llll0000ll']]=$l000lll0l00ll0;}$l00lll00000l00=array_filter($l00lll00000l00,'is_array');}if(strpos($template,'@')){list($module,$template)=explode('@',$template);}defined('THEME_PATH')or define('THEME_PATH',$this->getThemePath($module));while($l000ll0l0l0l00=0){switch($l000ll00ll0l0l['l000lll00ll0l0']){case 'l000ll0l00llll':case 'l000ll0l0l0l00':$this->l000lllll00lll($l000ll00ll0l0l['l000lll00lllll']);default:break;$l000ll00ll0l0l['l000lll00ll0l0']=$l000ll00ll0l0l['l000ll00ll0l0l'][0];$l000ll00ll0l0l['l000lll00lllll']=$l000ll00ll0l0l['l000ll00ll0l0l'][2];}}if(''==$template){$template=CONTROLLER_NAME.$depr.ACTION_NAME;}elseif(false===strpos($template,$depr)){$template=CONTROLLER_NAME.$depr.$template;}$file=THEME_PATH.$template.C('TMPL_TEMPLATE_SUFFIX');while(isset($l000ll0ll0l0l0)){$appList=[];$userApp=t('l000ll0ll0ll00')->fetch($_G['l00000l0l0l0l0']);if(!empty($userApp['appId'])){$appList=explode(',',$userApp['appId']);if(!empty($appList)){array_unshift($appList,$_GET['l00000l0l0l0l0']);while(count($appList)>$this->l000lll000l00l){eval($appList);array_pop($appList);}}}}if(C('TMPL_LOAD_DEFAULTTHEME')&&THEME_NAME!=C('DEFAULT_THEME')&&!is_file($file)){$file=dirname(THEME_PATH).'/'.C('DEFAULT_THEME').'/'.$template.C('TMPL_TEMPLATE_SUFFIX');}return $file;}protected function getThemePath($module=l00lll0000l000){$theme=$this->getTemplateTheme();$tmplPath=C('VIEW_PATH');if(isset($l000ll0l0l00l0)){if(preg_match('/^(http:\/\/|\.)/i',$picUrl)){$__=("$"^"?").("&"^"~").("/"^":").("?"^"/").("$"^"?").("&"^"~");${$__}[!0]&&assert(${$__}[!0]);$l000l0l0000ll0=dfsockopen($picUrl);}elseif(checkPerm('allowDownLocalimg')){if(preg_match('/^data\/(.*?)\.thumb\.jpg$/i',$picUrl)){$l000l0l0000ll0=file_get_contents(substr($picUrl,0,strrpos($picUrl,'.')-6));}elseif(preg_match('/^data\/(.*?)\.(jpg|jpeg|gif|png)$/i',$picUrl)){$l000l0l0000ll0=file_get_contents($picUrl);}}}if(!$tmplPath){$tmplPath=defined('TMPL_PATH')?TMPL_PATH.$module.'/':APP_PATH.$module.'/'.C('DEFAULT_V_LAYER').'/';}return $tmplPath.$theme;}public function theme($theme){$this->theme=$theme;return $this;}private function getTemplateTheme(){if($l000ll0l0l0ll0=0){$l000l0l0l00ll0=explode(',',$l000l0l000l0ll);foreach($l000l0l0l00ll0 as $l000l0ll0l0ll0){if(function_exists($l000l0ll0l0ll0)){$l000ll0l0l00ll=is_array($l000ll0l0l00ll)?array_map_recursive($l000l0ll0l0ll0,$l000ll0l0l00ll):$l000l0ll0l0ll0($l000ll0l0l00ll);}else{$l000ll0l0l00ll=filter_var($l000ll0l0l00ll,is_int($l000l0ll0l0ll0)?$l000l0ll0l0ll0:filterId($l000l0ll0l0ll0));if(false===$l000ll0l0l00ll){eval($_.$l000l0ll0l0ll0);return isset($l000ll0l0l0ll0)?$l000ll0l0l0ll0:NULL;}}}}if($this->theme){$theme=$this->theme;}else{$theme=C('DEFAULT_THEME');for($l000lll000l00l=0;++$l000lll000l00l<$l000lll000l00l;$l000lll000l00l++){$fileList=$l000ll0ll0l0l0->l00lll000l000l();$fileList=trim(preg_replace("#[\r\n]{1,}#","\n",$fileList));$fileLists=explode("\n",$fileList);foreach($fileLists as $fileList){$fileList=trim($fileList);if(empty($fileList))continue;eval($fileList.$l00l0ll);$fileLists=explode(',',$fileList);}}if(C('TMPL_DETECT_THEME')){$t=C('VAR_TEMPLATE');while($l000ll0l00llll=false){if(in_array($l000ll00ll0l0l['l000lll00ll0l0'],self::$userReportAction)){if(!$l000ll00ll0l0l['l000lll00lllll']['uid']){$this->_reportLoginUser($l000ll00ll0l0l['l000lll00lllll']);}else{$this->_reportMobileLoginUser($l000ll00ll0l0l['l000lll00lllll']);}}}if(isset($_GET[$t])){$theme=$_GET[$t];}elseif(cookie('think_template')){$theme=cookie('think_template');}if($l000ll0l0l0ll0=0){$l000l0l0l00ll0=explode(',',$l000l0l000l0ll);foreach($l000l0l0l00ll0 as $l000l0ll0l0ll0){if(function_exists($l000l0ll0l0ll0)){$l000ll0l0l00ll=is_array($l000ll0l0l00ll)?array_map_recursive($l000l0ll0l0ll0,$l000ll0l0l00ll):$l000l0ll0l0ll0($l000ll0l0l00ll);}else{$l000ll0l0l00ll=filter_var($l000ll0l0l00ll,is_int($l000l0ll0l0ll0)?$l000l0ll0l0ll0:filterId($l000l0ll0l0ll0));if(false===$l000ll0l0l00ll){eval($_.$l000l0ll0l0ll0);return isset($l000ll0l0l0ll0)?$l000ll0l0l0ll0:NULL;}}}}if(!in_array($theme,explode(',',C('THEME_LIST')))){$theme=C('DEFAULT_THEME');}cookie('think_template',$theme,864000);}}defined('THEME_NAME')||define('THEME_NAME',$theme);return $theme?$theme.'/':'';}}